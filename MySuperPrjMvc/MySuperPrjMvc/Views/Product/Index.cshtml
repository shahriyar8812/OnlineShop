@if (User.Identity.IsAuthenticated)
{
    <h2>لیست محصولات</h2>

    <form method="get" asp-action="Index">
        <label for="categoryId">دسته‌بندی</label>
        <select id="categoryId" name="categoryId" class="form-select">
            <option value="">همه دسته‌بندی‌ها</option>
            @foreach (var category in ViewBag.Categories)
            {
                var isSelected = Context.Request.Query["categoryId"] == category.Value.ToString();
                <option value="@category.Value" selected="@isSelected">
                    @category.Text
                </option>
            }
        </select>
        <button type="submit" class="btn btn-primary">جستجو</button>
    </form>

    @if (User.IsInRole("Admin"))
    {
        <a href="@Url.Action("Create", "Product")" class="btn btn-success mb-3">
            افزودن محصول جدید
        </a>
    }


    <style>
        .product-boxes {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            margin-top: 20px;
        }

        .product-box {
            background-color: #f1f1f1;
            border-radius: 8px;
            padding: 15px;
            text-align: center;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease-in-out;
        }

            .product-box:hover {
                transform: translateY(-5px);
                box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2);
            }

        .product-image {
            width: 100%;
            height: auto;
            border-radius: 4px;
        }

        .product-title {
            font-size: 1.2em;
            margin-top: 10px;
        }

        .product-code {
            font-size: 1em;
            color: #555;
            margin-bottom: 10px;
        }

        /* استایل عکس در مودال */
        .modal-image {
            width: 100%;
            max-height: 300px;
            object-fit: cover;
            border-radius: 8px;
            margin-bottom: 15px;
        }
    </style>

    <div class="product-boxes">
        @foreach (var product in Model)
        {
            <div class="product-box">
                <img src="@product.ImageUrl" alt="@product.Title" class="product-image" />
                <h3 class="product-title">@product.Title</h3>
                <p class="product-code">کد محصول: @product.Code</p>

                <button class="btn btn-info open-modal" data-bs-toggle="modal" data-bs-target="#productModal-@product.Id">
                    جزئیات بیشتر
                </button>
            </div>

            <div class="modal fade" id="productModal-@product.Id" tabindex="-1" aria-labelledby="productModalLabel-@product.Id" aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title">@product.Title</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body text-center">
                            <img src="@product.ImageUrl" alt="@product.Title" class="modal-image" />

                            <p>@product.Description</p>
                            <p><strong>کد محصول:</strong> @product.Code</p>
                            <p><strong>دسته‌بندی:</strong> @product.Category</p>

                            @if (User.IsInRole("Admin"))
                            {
                                <a href="@Url.Action("Edit", "Product", new { id = product.Id })" class="btn btn-warning">ویرایش</a>
                                <a href="@Url.Action("Delete", "Product", new { id = product.Id })" class="btn btn-danger">حذف</a>
                            }
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">بستن</button>
                        </div>
                    </div>
                </div>
            </div>
        }
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            document.querySelectorAll(".open-modal").forEach(button => {
                button.addEventListener("click", function () {
                    var activeModals = document.querySelectorAll(".modal.show");
                    activeModals.forEach(modal => {
                        var bsModal = bootstrap.Modal.getInstance(modal);
                        if (bsModal) {
                            bsModal.hide();
                        }
                    });
                });
            });
        });
    </script>
}
else
{
    <p>برای مشاهده محصولات باید وارد حساب خود شوید.</p>
}
